<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title data-i18n="app_title">Loky</title>
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet/dist/leaflet.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"
        />
        <link rel="stylesheet" href="css/style.css" />
    </head>

    <body>
        <div class="map-container">
            <div id="map"></div>

            <!-- Bloc de guidage centr√© en haut -->
            <div class="top-center" id="guidage"></div>

            <!-- Bouton de recentrage -->
            <div class="bottom-left">
                <button
                    id="btnCentrer"
                    data-i18n-title="btn_center_title"
                    title="Centrer sur ma position"
                >
                    üìç
                </button>
            </div>

            <!-- Mode d√©placement virtuel -->
            <div
                id="virtualMoveMode"
                class="virtual-move-mode"
                style="display: none"
            >
                <!-- Croix directionnelle -->
                <div class="dpad-container">
                    <button class="dpad-btn dpad-up" data-direction="up">
                        ‚ñ≤
                    </button>
                    <div class="dpad-middle">
                        <button
                            class="dpad-btn dpad-left"
                            data-direction="left"
                        >
                            ‚óÄ
                        </button>
                        <div class="dpad-center"></div>
                        <button
                            class="dpad-btn dpad-right"
                            data-direction="right"
                        >
                            ‚ñ∂
                        </button>
                    </div>
                    <button class="dpad-btn dpad-down" data-direction="down">
                        ‚ñº
                    </button>
                </div>
                <!-- Menu de contr√¥le -->
                <div class="virtual-move-controls">
                    <div class="speed-control">
                        <label data-i18n="virtual_speed">Vitesse</label>
                        <input
                            type="range"
                            id="virtualSpeedSlider"
                            min="1"
                            max="10"
                            value="5"
                        >
                        <span id="virtualSpeedValue">5</span>
                    </div>
                    <div class="home-controls">
                        <button
                            id="btnSetHome"
                            class="btn-home"
                            data-i18n="virtual_set_home"
                            title="D√©finir comme maison"
                        >
                            üè† D√©finir
                        </button>
                        <button
                            id="btnGoHome"
                            class="btn-home btn-home-go"
                            data-i18n="virtual_go_home"
                            title="Aller √† la maison"
                        >
                            üè† Aller
                        </button>
                    </div>
                    <button
                        id="btnExitVirtualMode"
                        class="btn-exit-virtual"
                        data-i18n="virtual_exit"
                    >
                        Quitter
                    </button>
                </div>
            </div>

            <!-- Guidage vers parking le plus proche -->
            <div class="menuGuider bottom-center">
                <h2 id="nearestParkingName"></h2>
                <button
                    id="btnGuider"
                    onclick="goToNearestParking()"
                    data-i18n-title="btn_go"
                    data-i18n="btn_go"
                    title="Allez"
                >
                    Allez
                </button>
            </div>

            <!-- Bouton de param√®tres en haut √† droite -->
            <div class="top-right">
                <button id="parametre">‚öôÔ∏è</button>
            </div>
            <!-- üîß MENU PARAM√àTRES -->
            <div id="menuParam">
                <button class="close-btn" onclick="fermerMenu()">‚ùå</button>
                <h2 data-i18n="settings_title">Param√®tres</h2>

                <div class="settings-content">
                    <!-- S√©lecteur de langue -->
                    <div class="settings-section settings-language">
                        <div class="settings-row">
                            <span data-i18n="settings_language">Langue</span>
                            <select
                                id="languageSelect"
                                onchange="changeLanguage(this.value)"
                            >
                                <option value="fr">Fran√ßais</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>

                    <!-- Section v√©hicules (visible uniquement si connect√©) -->
                    <div
                        id="vehicleListSection"
                        class="settings-section"
                        style="display: none"
                    >
                        <div class="settings-row">
                            <strong data-i18n="my_vehicles"
                            >Mes v√©hicules</strong>
                            <button
                                id="btnAddVehicle"
                                class="btn-small-add"
                                title="Ajouter"
                            >
                                +
                            </button>
                        </div>
                        <div id="vehicleList" class="vehicle-list"></div>
                        <div
                            id="noVehicleMsg"
                            data-i18n="no_vehicle"
                            class="no-vehicle-msg"
                        >
                            Aucun v√©hicule enregistr√©
                        </div>
                    </div>

                    <!-- Param√®tres invit√©: PMR, Hauteur max, √âlectrique (masqu√© si connect√©) -->
                    <div id="guestSettingsBlock" class="settings-section">
                        <div class="settings-row">
                            <span data-i18n="settings_pmr"
                            >PMR (mobilit√© r√©duite)</span>
                            <label class="switch">
                                <input
                                    type="checkbox"
                                    id="pmrToggle"
                                    onchange="togglePMR()"
                                >
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="settings-row">
                            <span data-i18n="settings_height"
                            >Hauteur max (cm)</span>
                            <input
                                type="number"
                                id="heightMax"
                                data-i18n-placeholder="settings_height_placeholder"
                                placeholder="ex: 200"
                                class="input-small"
                            >
                        </div>
                        <div class="settings-row">
                            <span data-i18n="settings_electric"
                            >V√©hicules √©lectriques</span>
                            <label class="switch">
                                <input type="checkbox" id="electricToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Param√®tres communs (toujours visibles) -->
                    <div class="settings-section">
                        <div class="settings-row">
                            <span data-i18n="settings_free_only"
                            >Gratuit uniquement</span>
                            <label class="switch">
                                <input type="checkbox" id="payantToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- V√©rification disponibilit√© -->
                    <div class="settings-section">
                        <div class="settings-row">
                            <span
                                id="availabilityLabel"
                                data-i18n="settings_availability"
                            >V√©rifier disponibilit√©</span>
                            <label class="switch">
                                <input type="checkbox" id="availabilityToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Spacer pour pousser les boutons en bas -->
                    <div class="settings-spacer"></div>

                    <!-- Boutons Connexion et Inscription (visible si non connect√©) -->
                    <div
                        id="authButtonsContainer"
                        class="settings-section settings-auth-buttons"
                    >
                        <button
                            id="btnConnexion"
                            data-i18n="btn_connexion"
                            class="btn-auth"
                        >
                            Connexion
                        </button>
                        <button
                            id="btnInscription"
                            data-i18n="btn_inscription"
                            class="btn-auth btn-auth-secondary"
                        >
                            Inscription
                        </button>
                    </div>

                    <!-- Section utilisateur connect√© (visible si connect√©) -->
                    <div
                        id="userLoggedContainer"
                        class="settings-section settings-user-logged"
                        style="display: none"
                    >
                        <div class="user-info-row">
                            <span id="loggedUserLabel" data-i18n="logged_in_as"
                            >Connect√©</span>
                            <strong id="loggedUserName"></strong>
                        </div>
                        <button
                            id="btnLogout"
                            data-i18n="btn_logout"
                            class="btn-logout"
                        >
                            D√©connexion
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Auth (login / register) -->
        <div id="authModal" class="modal-overlay">
            <div class="modal-box" id="authBox">
                <button id="authClose" class="close-btn">‚úñ</button>
                <h3 data-i18n="login_title" id="authTitle">Connexion</h3>
                <div id="authError" class="auth-error" style="display: none">
                </div>
                <form id="authForm">
                    <div class="modal-form-content">
                        <label>
                            <div data-i18n="email_label">Email</div>
                            <input
                                id="authEmail"
                                type="email"
                                required
                                placeholder=""
                                data-i18n-placeholder="email_placeholder"
                                class="modal-input"
                            >
                        </label>
                        <label>
                            <div data-i18n="password_label">Mot de passe</div>
                            <input
                                id="authPassword"
                                type="password"
                                required
                                placeholder=""
                                data-i18n-placeholder="password_placeholder"
                                class="modal-input"
                            >
                        </label>
                        <!-- Champs suppl√©mentaires pour inscription -->
                        <div id="registerFields" style="display: none">
                            <label>
                                <div data-i18n="profile_name">Nom</div>
                                <input
                                    id="authName"
                                    type="text"
                                    placeholder=""
                                    data-i18n-placeholder="profile_name_placeholder"
                                    class="modal-input"
                                >
                            </label>
                            <label
                                style="display: flex; align-items: center; justify-content: space-between; margin-top: 8px"
                            >
                                <span data-i18n="profile_pmr">PMR</span>
                                <label class="switch">
                                    <input type="checkbox" id="authPmr">
                                    <span class="slider"></span>
                                </label>
                            </label>
                        </div>
                        <div class="modal-buttons">
                            <button
                                id="authSubmit"
                                type="submit"
                                class="btn-primary"
                            >
                                Se connecter
                            </button>
                            <button
                                id="authSwitch"
                                type="button"
                                class="btn-secondary"
                            >
                                Inscription
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal V√©hicule -->
        <div id="vehicleModal" class="modal-overlay">
            <div class="modal-box" id="vehicleBox">
                <button id="vehicleClose" class="close-btn">‚úñ</button>
                <h3 data-i18n="vehicle_title" id="vehicleTitle">
                    Mon v√©hicule
                </h3>
                <div id="vehicleError" class="auth-error" style="display: none">
                </div>
                <form id="vehicleForm">
                    <div class="modal-form-content">
                        <label>
                            <div data-i18n="vehicle_plate">
                                Plaque d'immatriculation
                            </div>
                            <input
                                id="vehiclePlate"
                                type="text"
                                placeholder=""
                                data-i18n-placeholder="vehicle_plate_placeholder"
                                class="modal-input"
                            >
                        </label>
                        <label>
                            <div data-i18n="vehicle_height">Hauteur (cm)</div>
                            <input
                                id="vehicleHeight"
                                type="number"
                                placeholder=""
                                data-i18n-placeholder="vehicle_height_placeholder"
                                class="modal-input"
                            >
                        </label>
                        <label
                            style="display: flex; align-items: center; justify-content: space-between; margin-top: 8px"
                        >
                            <span data-i18n="vehicle_electric"
                            >V√©hicule √©lectrique</span>
                            <label class="switch">
                                <input type="checkbox" id="vehicleElectric">
                                <span class="slider"></span>
                            </label>
                        </label>
                        <label
                            style="display: flex; align-items: center; justify-content: space-between; margin-top: 8px"
                        >
                            <span data-i18n="vehicle_velo">V√©lo</span>
                            <label class="switch">
                                <input type="checkbox" id="vehicleVelo">
                                <span class="slider"></span>
                            </label>
                        </label>
                        <div class="modal-buttons">
                            <button
                                id="vehicleSave"
                                type="submit"
                                class="btn-primary"
                                data-i18n="vehicle_save"
                            >
                                Enregistrer
                            </button>
                            <button
                                id="vehicleDelete"
                                type="button"
                                class="btn-danger"
                                data-i18n="vehicle_delete"
                                style="display: none"
                            >
                                Supprimer
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script
            src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"
        ></script>

        <script src="js/i18n.js?v=1.0"></script>
        <script src="js/providers/cities.js?v=1.2"></script>
        <script src="js/main.js?v=1.2"></script>
        <script src="js/utils.js?v=1.2"></script>
        <script src="js/api.js?v=1.2"></script>
        <script src="js/map.js?v=1.2"></script>
        <script src="js/ui.js?v=1.2"></script>
    </body>
</html>
